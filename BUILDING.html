<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<title>Building prc-tools</title>
</head>
<body>

<h1>Building prc-tools</h1>

Prc-tools is built regularly on Linux and Cygwin, and should build without
too much trouble on other Unix-like systems.  These regular builds are done
either with the RPM spec file <code>prc-tools.spec</code> or with the
<code>prc-tools.build</code> script.  While we make every effort to keep
these instructions up to date, those two files should be considered to
represent the canonical tested build procedures.

<p>
Problems encountered while building prc-tools are likely to be bugs in the
build scripts, makefiles, or procedures, and we would like to hear about them.
The <code>prc-tools-devel</code> mailing list is the right place to report
difficulties in building prc-tools itself.  (But it is <strong>not</strong>
the right place for difficulties encountered while <em>using</em> the tools.)

<p>
In this document, we use <code>prc-tools-srcdir</code> to refer to the top
level source directory for prc-tools.  If you are working from CVS, this
directory's name will be simply <code>prc-tools</code>.  If you have downloaded
a source tarball, it will be something like <code>prc-tools-2.1</code>.

<h2>Prc-tools and Palm OS SDKs</h2>

Prc-tools contains both host tools which run on your development computer
and run-time support code which is linked into your application.  Header
files of some kind describing how to call several Palm OS API functions
are needed to compile this run-time support code.

<p>
For a Palm OS application, these header files are provided by a Palm OS
SDK.  However, the audience for prc-tools is different:  It is often built
by people, such as system administrators and OS distributors, who may not
themselves be Palm OS programmers.  It is unreasonable to require such
people to first obtain a separate non-redistributable SDK that they may not
subsequently wish to use, just so that they can compile a small part of
this package.

<p>
Hence prc-tools contains header files (in the <code>bootstrap</code>
subdirectory) which declare just enough Palm OS API functions and related
machinery to compile the run-time support code.  Thus prc-tools itself can
be compiled by itself, without requiring any separate Palm OS SDK to be
installed on the build system.  (Of course people later <strong>using</strong>
prc-tools will likely need to obtain an SDK themselves if they wish to
write non-trivial applications.)

<p>
See <a href="http://bugs.debian.org/78745">Debian bug #78745</a> and
<code>bootstrap/Makefile</code> for further details of this arrangement.

<h2>Build tools required</h2>

You will need to have a unidiff-capable implementation of
<a href="http://www.gnu.org/software/patch/patch.html">patch</a>,
a C compiler, a C++ compiler, lex or
<a href="http://www.gnu.org/software/flex/flex.html">flex</a>, and
yacc or <a href="http://www.gnu.org/software/bison/bison.html">bison</a>
installed.  Some of the post-linker tools are written with C++ and
<a href="http://www.sgi.com/Technology/STL/">STL</a>, so if you are using
GCC you will need at least egcs 1.1.1 or so, or any GCC 2.95.  If your
normal <code>gcc</code> or <code>cc</code> is earlier than this but
you have a recent GCC installed as, e.g., <code>gcc295</code>,
you can specify that the tools be built using the non-default compiler
by defining variables for the configure command:
<blockquote><pre>
~/build$ CC=gcc295 CXX=g++295 ../prc-tools-srcdir/configure <em>...etc...</em>
</pre></blockquote>

<p>
Particularly if you are a maintainer working on prc-tools, you may also
need the following:
<ul>
<li>
If you do much work on the configuration files or are working from CVS, you'll
need <a href="http://sources.redhat.com/autoconf/">autoconf</a>.
At present, prc-tools requires autoconf 2.13 or so rather than one of the
more recent (and not entirely compatible) 2.5x versions.

<li>
If you are working on the run-time support code, you may need to update the
<code>bootstrap</code> headers.
A <a href="http://www.palmos.com/dev/tech/tools/">Palm OS SDK</a>
and some Palm OS device (such as
<a href="http://www.palmos.com/dev/tech/tools/emulator/">Poser</a>
and a ROM) are needed to do this, because the headers are generated by running
a Palm OS application, GenBootstrap.

<li>
If you want to generate the HTML documentation, you'll need
<a href="http://www.mathematik.uni-kl.de/~obachman/Texi2html/">texi2html</a>
(version 1.64 or later; previous versions do not understand the options with
which prc-tools invokes it).
</ul>

<h2>Unpacking and patching the sources</h2>

This prc-tools package contains source code for the post-linker tools and
run-time support on the device, and patches against
<a href="ftp://ftp.gnu.org/pub/gnu/binutils/">binutils-2.14</a>,
<a href="ftp://sources.redhat.com/pub/gdb/releases/">gdb-5.3</a>, and
<a href="ftp://gcc.gnu.org/pub/gcc/releases/">gcc-2.95.3 and gcc-3.3</a>.
You will need to download source for each of these packages separately, either
from a <a href="http://www.gnu.org/order/ftp.html">GNU mirror</a> or from
<a href="http://prc-tools.sourceforge.net/misc/">http://prc-tools.sourceforge.net/misc/</a>.

<p>
(Note that the patches are in unified diff format and some
<code>patch</code> implementations, notably on Solaris, do not handle
this format correctly.  If you are thus afflicted, we recommend using
<a href="http://www.gnu.org/software/patch/patch.html">GNU patch</a>
instead.)

<p>
Once you have downloaded the packages, you need to unpack them and apply
the patches:
<blockquote><pre>
~$ tar xfz prc-tools-2.1.tar.gz
~$ tar xfz binutils-2.14.tar.gz
~$ tar xfz gdb-5.3.tar.gz
~$ tar xfz gcc-2.95.3.tar.gz
~$ tar xfz gcc-3.3.tar.gz
~$ cat prc-tools-srcdir/*.palmos.diff | patch -p0
</pre></blockquote>

<p>
If you don't have autoconf installed, you need to fix the datestamp
on <code>cstamp-h.in</code> to prevent autoconf from being invoked to
regenerate it:
<blockquote><pre>
~$ touch gcc-2.95.3/gcc/cstamp-h.in
</pre></blockquote>

<p>
Finally, you need to make the GNU packages available to prc-tools's configure
script and top-level Makefile so that building all the packages can be
integrated into just one build:

<blockquote><pre>
~$ cd prc-tools-srcdir
~/prc-tools-srcdir$ ln -s ../binutils-2.14 binutils
~/prc-tools-srcdir$ ln -s ../gdb-5.3 gdb
~/prc-tools-srcdir$ ln -s ../gcc-2.95.3 gcc295
~/prc-tools-srcdir$ ln -s ../gcc-3.3 gcc
~/prc-tools-srcdir$ cd ..
</pre></blockquote>
At present, the m68k compiler will be built from <code>gcc295</code> and the
ARM compiler from <code>gcc</code>; if you are only building one of them, you
can omit the other directory.  (In the future, the m68k patches will be
ported to GCC 3.x, and the <code>gcc295</code> directory will disappear.)
<p>
(On Windows, if you use any non-Cygwin programs in your build, you should
use <code>mv</code> instead of <code>ln -s</code> since non-Cygwin programs
can't see through Cygwin's symlinks.)

<p>
You can optionally generate HTML versions of the documentation for
prc-tools, binutils, GDB, GCC, and also for
<a href="http://www.gnu.org/software/make/make.html">make</a>.
To generate the make documentation, you'll also need to make
<a href="ftp://ftp.gnu.org/pub/gnu/make/">GNU Make</a> source code available
similarly, as <code>prc-tools-srcdir/make</code>.
(Due to recent rearrangements in the make package, this requires at least
version 3.80 of GNU Make.)

<h2>Configuring</h2>

It's <a href="http://gcc.gnu.org/install/configure.html">recommended</a>
that you configure and build these packages in a directory separate from
their source trees:

<blockquote><pre>
~$ mkdir build
~$ cd build
~/build$ mkdir empty
~/build$ ../prc-tools-srcdir/configure --target=m68k-palmos \
	 --enable-languages=c,c++ \
	 --with-headers=`pwd`/empty
</pre></blockquote>

(Source tarballs contain the <code>configure</code> script, but CVS does not.
If you are building from CVS you'll have to use
<a href="http://sources.redhat.com/autoconf/">autoconf</a> -- 2.13,
not 2.5x -- to regenerate it from <code>configure.in</code> first.)

<p>
The parameters shown above must be given, with whatever values are appropriate,
because their defaults will cause problems.  In addition to the standard
configure options, the following options can be used:
<dl>
<dt>
<code>--enable-targets=m68k-palmos,arm-palmos</code>
<dd>
Sets multiple target platforms for the tool chain: binutils, GCC, etc will be
built for each target, and the generic tools in <code>tools</code> will be
configured for <em>all</em> of the given targets.  You must use this or
<code>--target</code>, but not both.
<dt>
<code>--target=m68k-palmos</code>
<dd>
Sets the target platform for the tool chain.  The target used in
prc-tools-0.5.0 was <code>m68k-palmos-coff</code>; dropping the
<code>-coff</code> now will ease a potential future move to ELF, and
just plain makes more sense.  But at the moment <code>m68k-palmos</code>
is merely an alias for <code>m68k-palmos-coff</code>, so you can use
the full name for compatibility with prc-tools-0.5.0 for now if you like.
<dt>
<code>--enable-languages=c,c++</code>
<dd>
Only build C and C++ compilers.  In particular, the Objective-C runtime
hasn't been ported to Palm OS, so <code>objc</code> won't work here.
<dt>
<code>--with-headers=`pwd`/empty</code>
<dd>
GCC fixes system headers by filtering out non-ISO standard constructs.
Pointing it at an empty directory like this effectively suppresses that
behaviour -- which may or may not be the best idea, but it makes life
easier for now.  :-)
<dt>
<code><a name="palmdev-prefix">--with-palmdev-prefix=/opt/palmdev</a></code>
<dd>
This is where the tool chain
will look for Palm OS SDK headers and libraries and so on.
You can put this wherever you like; by convention, we use
<code>/opt/palmdev</code> on Unix and <code>/PalmDev</code>
on Windows.  By default, the tool chain will look in <code>/opt/palmdev</code>.
<dt>
<code>--enable-html-docs[=/path]</code>
<dd>
Generate HTML-formatted documentation for prc-tools and also whichever of
binutils, GDB, GCC, and make have been made available within the source tree.
By default, generation of HTML documentation is disabled.  If you enable it,
you can specify where the resulting HTML files should be installed, or, if you
omit the optional directory argument, <em>palmdev-prefix</em><code>/doc</code>
will be used by default.
</dl>

<h2>Building and installing</h2>

You can build and install prc-tools just as you would any other package:
<blockquote><pre>
~/build$ make
~/build$ make install
</pre></blockquote>

You may need to change user (e.g. to <strong>root</strong>) if you are
installing to directories to which your usual user doesn't have write access.

<p>
In the past, building prc-tools was a tedious multistage process of
<ul>
<li> building and installing binutils;
<li> building and installing GCC;
<li> building the Palm OS runtime code.
</ul>
This multistage process was needed because GCC required an installed Palm OS
binutils before it could be built, and in turn the run-time support code
(such as that in the <code>crt</code> subdirectory) needed both binutils
and GCC to be installed before it could be built.

<p>
The top-level prc-tools Makefile now tells the GCC build process to use an
uninstalled binutils from <code>~/build/binutils</code>, and tells the target
run-time build process to use an uninstalled GCC from <code>~/build/gcc</code>
and the same uninstalled binutils.  Thus later stages of the build use the
tools you have just built from the places in which you have built them,
instead of requiring the previous intertwined build/install process.

<p>
If you use one of the lower level makefiles directly, or if you have omitted
the <code>binutils</code> or <code>gcc</code> directories from your source
tree, the build processes will fall back to using the respective installed
utilities from your <code>PATH</code>.  The build will fail unless you have
previously installed such utilities.

<p>
There are further details in the GCC distribution's
<a href="http://gcc.gnu.org/install/"><code>install</code> directory</a>
and also in the <a href="http://www.objsw.com/CrossGCC/">Cross-FAQ</a>,
if you run into problems.

<p><hr>
<em>To the
<a href="http://prc-tools.sourceforge.net/">prc-tools website</a></em>

</body></html>
